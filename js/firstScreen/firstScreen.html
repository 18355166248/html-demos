<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é¡µé¢æ€§èƒ½æŒ‡æ ‡åˆ†æ - PerformanceNavigationTiming</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        line-height: 1.6;
      }

      .container {
        border: 1px solid #ddd;
        padding: 20px;
        margin: 20px 0;
        border-radius: 5px;
      }

      .image-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 20px 0;
      }

      .image-item {
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
      }

      .image-item img {
        max-width: 150px;
        max-height: 100px;
        object-fit: cover;
      }

      .log {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        margin: 10px 0;
        max-height: 400px;
        overflow-y: auto;
        font-size: 12px;
      }

      .highlight {
        background: #fff3cd;
        padding: 10px;
        border-left: 4px solid #ffc107;
        margin: 10px 0;
      }

      .timeline {
        background: #e9ecef;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
      }

      .timeline h3 {
        margin-top: 0;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .metric-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #007bff;
      }

      .metric-card h4 {
        margin: 0 0 10px 0;
        color: #007bff;
      }

      .metric-value {
        font-size: 18px;
        font-weight: bold;
        color: #28a745;
      }

      .metric-description {
        font-size: 12px;
        color: #6c757d;
        margin-top: 5px;
      }

      .warning {
        background: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border-left: 4px solid #dc3545;
      }

      .info {
        background: #d1ecf1;
        color: #0c5460;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        border-left: 4px solid #17a2b8;
      }
    </style>
  </head>

  <body>
    <h1>é¡µé¢æ€§èƒ½æŒ‡æ ‡åˆ†æ - PerformanceNavigationTiming</h1>

    <div class="warning">
      <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong>
      <p>
        performance.timing å·²è¢«åºŸå¼ƒï¼Œç°åœ¨ä½¿ç”¨ PerformanceNavigationTiming API
        è¿›è¡Œæ€§èƒ½åˆ†æ
      </p>
    </div>

    <div class="info">
      <strong>ğŸ“Š PerformanceNavigationTiming ä¼˜åŠ¿ï¼š</strong>
      <ul>
        <li>æä¾›æ›´ç²¾ç¡®çš„æ—¶é—´æˆ³</li>
        <li>æ”¯æŒé«˜ç²¾åº¦æ—¶é—´</li>
        <li>æ›´å¥½çš„æµè§ˆå™¨å…¼å®¹æ€§</li>
        <li>æ›´ä¸°å¯Œçš„æ€§èƒ½æŒ‡æ ‡</li>
      </ul>
    </div>

    <div class="highlight">
      <strong>å…³é”®æ¦‚å¿µï¼š</strong>
      <ul>
        <li>
          <strong>DOMContentLoaded</strong
          >ï¼šå½“HTMLæ–‡æ¡£è¢«å®Œå…¨åŠ è½½å’Œè§£ææ—¶è§¦å‘ï¼Œä¸ç­‰å¾…æ ·å¼è¡¨ã€å›¾ç‰‡å’Œå­æ¡†æ¶çš„åŠ è½½
        </li>
        <li>
          <strong>window.onload</strong
          >ï¼šå½“æ•´ä¸ªé¡µé¢ï¼ˆåŒ…æ‹¬æ‰€æœ‰ä¾èµ–èµ„æºå¦‚å›¾ç‰‡ã€æ ·å¼è¡¨ç­‰ï¼‰éƒ½åŠ è½½å®Œæˆæ—¶è§¦å‘
        </li>
        <li>
          <strong>PerformanceNavigationTiming</strong
          >ï¼šæä¾›è¯¦ç»†çš„é¡µé¢åŠ è½½æ€§èƒ½æŒ‡æ ‡
        </li>
      </ul>
    </div>

    <div class="timeline">
      <h3>äº‹ä»¶è§¦å‘é¡ºåºï¼š</h3>
      <ol>
        <li>DOMContentLoadedï¼ˆHTMLè§£æå®Œæˆï¼‰</li>
        <li>å›¾ç‰‡åŠ è½½å®Œæˆ</li>
        <li>window.onloadï¼ˆæ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼‰</li>
      </ol>
    </div>

    <div class="container">
      <h2>æ€§èƒ½æŒ‡æ ‡åˆ†æ</h2>
      <div class="metrics-grid" id="metricsGrid">
        <!-- æ€§èƒ½æŒ‡æ ‡å°†åœ¨è¿™é‡ŒåŠ¨æ€æ˜¾ç¤º -->
      </div>
    </div>

    <div class="container">
      <h2>å›¾ç‰‡åŠ è½½æµ‹è¯•</h2>
      <p>ä»¥ä¸‹å›¾ç‰‡ä¼šæ¨¡æ‹Ÿç½‘ç»œå»¶è¿ŸåŠ è½½ï¼Œè§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºçš„äº‹ä»¶è§¦å‘é¡ºåºï¼š</p>

      <div class="image-container">
        <div class="image-item">
          <img
            src="https://picsum.photos/200/150?random=1"
            alt="å›¾ç‰‡1"
            onload="logEvent('å›¾ç‰‡1åŠ è½½å®Œæˆ', Date.now())"
            onerror="logEvent('å›¾ç‰‡1åŠ è½½å¤±è´¥', Date.now())"
          />
          <p>å›¾ç‰‡1</p>
        </div>
        <div class="image-item">
          <img
            src="https://picsum.photos/200/150?random=2"
            alt="å›¾ç‰‡2"
            onload="logEvent('å›¾ç‰‡2åŠ è½½å®Œæˆ', Date.now())"
            onerror="logEvent('å›¾ç‰‡2åŠ è½½å¤±è´¥', Date.now())"
          />
          <p>å›¾ç‰‡2</p>
        </div>
        <div class="image-item">
          <img
            src="https://picsum.photos/200/150?random=3"
            alt="å›¾ç‰‡3"
            onload="logEvent('å›¾ç‰‡3åŠ è½½å®Œæˆ', Date.now())"
            onerror="logEvent('å›¾ç‰‡3åŠ è½½å¤±è´¥', Date.now())"
          />
          <p>å›¾ç‰‡3</p>
        </div>
        <div class="image-item">
          <img
            src="https://picsum.photos/200/150?random=4"
            alt="å›¾ç‰‡4"
            onload="logEvent('å›¾ç‰‡4åŠ è½½å®Œæˆ', Date.now())"
            onerror="logEvent('å›¾ç‰‡4åŠ è½½å¤±è´¥', Date.now())"
          />
          <p>å›¾ç‰‡4</p>
        </div>
      </div>
    </div>

    <div class="container">
      <h2>äº‹ä»¶ç›‘å¬å™¨</h2>
      <div class="log" id="eventLog">
        <div>äº‹ä»¶æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
      </div>
    </div>

    <script>
      const startTime = performance.now();

      function logEvent(message, timestamp = performance.now()) {
        const cha = Math.round(timestamp - startTime);
        const logDiv = document.getElementById("eventLog");
        const logEntry = document.createElement("div");
        logEntry.innerHTML = `<span style="color: #007bff;">[${cha}ms]</span> ${message}`;
        logDiv.appendChild(logEntry);
        console.log(`[${cha}ms] ${message}`);
      }

      // æ€§èƒ½æŒ‡æ ‡åˆ†æå‡½æ•°
      function analyzePerformance() {
        const navigation = performance.getEntriesByType("navigation")[0];
        if (!navigation) {
          logEvent("âŒ æ— æ³•è·å– PerformanceNavigationTiming æ•°æ®");
          return;
        }

        const metrics = {
          // åŸºç¡€æ—¶é—´æŒ‡æ ‡
          DNSæŸ¥è¯¢æ—¶é—´: {
            value: Math.round(
              navigation.domainLookupEnd - navigation.domainLookupStart
            ),
            description: "DNSè§£æè€—æ—¶",
          },
          TCPè¿æ¥æ—¶é—´: {
            value: Math.round(navigation.connectEnd - navigation.connectStart),
            description: "TCPè¿æ¥å»ºç«‹è€—æ—¶",
          },
          SSLæ¡æ‰‹æ—¶é—´: {
            value: Math.round(
              navigation.connectEnd - navigation.secureConnectionStart
            ),
            description: "SSL/TLSæ¡æ‰‹è€—æ—¶",
          },
          è¯·æ±‚å“åº”æ—¶é—´: {
            value: Math.round(navigation.responseEnd - navigation.requestStart),
            description: "ä»å‘é€è¯·æ±‚åˆ°æ¥æ”¶å“åº”çš„æ—¶é—´",
          },
          DOMè§£ææ—¶é—´: {
            value: Math.round(
              navigation.domContentLoadedEventEnd -
                navigation.domContentLoadedEventStart
            ),
            description: "DOMå†…å®¹åŠ è½½äº‹ä»¶å¤„ç†æ—¶é—´",
          },
          é¡µé¢åŠ è½½æ—¶é—´: {
            value: Math.round(
              navigation.loadEventEnd - navigation.loadEventStart
            ),
            description: "é¡µé¢loadäº‹ä»¶å¤„ç†æ—¶é—´",
          },
          æ€»åŠ è½½æ—¶é—´: {
            value: Math.round(navigation.loadEventEnd - navigation.fetchStart),
            description: "ä»å¼€å§‹è·å–åˆ°é¡µé¢å®Œå…¨åŠ è½½çš„æ—¶é—´",
          },
          "é¦–å­—èŠ‚æ—¶é—´(TTFB)": {
            value: Math.round(
              navigation.responseStart - navigation.requestStart
            ),
            description: "Time To First Byte - é¦–å­—èŠ‚æ—¶é—´",
          },
          DOMå†…å®¹å°±ç»ªæ—¶é—´: {
            value: Math.round(
              navigation.domContentLoadedEventEnd - navigation.fetchStart
            ),
            description: "DOMå†…å®¹åŠ è½½å®Œæˆæ—¶é—´",
          },
          é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´: {
            value: Math.round(navigation.loadEventEnd - navigation.fetchStart),
            description: "é¡µé¢å®Œå…¨åŠ è½½å®Œæˆæ—¶é—´",
          },
        };

        // æ˜¾ç¤ºæ€§èƒ½æŒ‡æ ‡
        const metricsGrid = document.getElementById("metricsGrid");
        metricsGrid.innerHTML = "";

        Object.entries(metrics).forEach(([name, data]) => {
          const metricCard = document.createElement("div");
          metricCard.className = "metric-card";
          metricCard.innerHTML = `
            <h4>${name}</h4>
            <div class="metric-value">${data.value}ms</div>
            <div class="metric-description">${data.description}</div>
          `;
          metricsGrid.appendChild(metricCard);
        });

        // è®°å½•å…³é”®æŒ‡æ ‡åˆ°æ—¥å¿—
        logEvent(`ğŸ“Š DNSæŸ¥è¯¢æ—¶é—´: ${metrics["DNSæŸ¥è¯¢æ—¶é—´"].value}ms`);
        logEvent(`ğŸ“Š TCPè¿æ¥æ—¶é—´: ${metrics["TCPè¿æ¥æ—¶é—´"].value}ms`);
        logEvent(`ğŸ“Š TTFB: ${metrics["é¦–å­—èŠ‚æ—¶é—´(TTFB)"].value}ms`);
        logEvent(`ğŸ“Š DOMå†…å®¹å°±ç»ª: ${metrics["DOMå†…å®¹å°±ç»ªæ—¶é—´"].value}ms`);
        logEvent(`ğŸ“Š é¡µé¢å®Œå…¨åŠ è½½: ${metrics["é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´"].value}ms`);
        logEvent(`ğŸ“Š æ€»åŠ è½½æ—¶é—´: ${metrics["æ€»åŠ è½½æ—¶é—´"].value}ms`);

        // æ€§èƒ½è¯„ä¼°
        const ttfb = metrics["é¦–å­—èŠ‚æ—¶é—´(TTFB)"].value;
        const domReady = metrics["DOMå†…å®¹å°±ç»ªæ—¶é—´"].value;
        const totalLoad = metrics["æ€»åŠ è½½æ—¶é—´"].value;

        if (ttfb < 200) {
          logEvent("âœ… TTFB ä¼˜ç§€ (< 200ms)");
        } else if (ttfb < 600) {
          logEvent("âš ï¸ TTFB ä¸€èˆ¬ (200-600ms)");
        } else {
          logEvent("âŒ TTFB è¾ƒå·® (> 600ms)");
        }

        if (domReady < 1000) {
          logEvent("âœ… DOMå°±ç»ªæ—¶é—´ä¼˜ç§€ (< 1s)");
        } else if (domReady < 3000) {
          logEvent("âš ï¸ DOMå°±ç»ªæ—¶é—´ä¸€èˆ¬ (1-3s)");
        } else {
          logEvent("âŒ DOMå°±ç»ªæ—¶é—´è¾ƒå·® (> 3s)");
        }

        if (totalLoad < 2000) {
          logEvent("âœ… æ€»åŠ è½½æ—¶é—´ä¼˜ç§€ (< 2s)");
        } else if (totalLoad < 5000) {
          logEvent("âš ï¸ æ€»åŠ è½½æ—¶é—´ä¸€èˆ¬ (2-5s)");
        } else {
          logEvent("âŒ æ€»åŠ è½½æ—¶é—´è¾ƒå·® (> 5s)");
        }
      }

      window.onload = function () {
        logEvent("ğŸ‰ window.onload è§¦å‘ - æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ");

        // ä½¿ç”¨ PerformanceNavigationTiming åˆ†ææ€§èƒ½
        analyzePerformance();
      };

      document.addEventListener("DOMContentLoaded", function () {
        logEvent("âœ… DOMContentLoaded è§¦å‘ - HTMLæ–‡æ¡£è§£æå®Œæˆ");
      });

      // æ¨¡æ‹Ÿä¸€äº›DOMæ“ä½œ
      setTimeout(() => {
        const newDiv = document.createElement("div");
        newDiv.textContent = "åŠ¨æ€æ·»åŠ çš„å…ƒç´ ";
        newDiv.style.color = "green";
        document.body.appendChild(newDiv);
        logEvent("ğŸ“ åŠ¨æ€æ·»åŠ DOMå…ƒç´ ");
      }, 100);

      // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
      setTimeout(() => {
        logEvent("â° å¼‚æ­¥æ“ä½œå®Œæˆ");
      }, 500);

      logEvent("ğŸš€ å¼€å§‹æ‰§è¡Œè„šæœ¬");
    </script>

    <!-- å¤–éƒ¨è„šæœ¬ -->
    <script src="../_js/script.js"></script>
    <script src="../_js/async.js" async></script>
    <script src="../_js/defer.js" defer></script>
  </body>
</html>
